<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The 0L Developer Book</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Mission</a></li><li class="chapter-item expanded affix "><li class="part-title">0L Technology Participants</li><li class="chapter-item expanded "><a href="tech_participants/carpe_miners.html"><strong aria-hidden="true">1.</strong> carpe miners</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> nodes</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="tech_participants/validators.html"><strong aria-hidden="true">2.1.</strong> validators</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="tech_participants/validator_onboarding.html"><strong aria-hidden="true">2.1.1.</strong> onboarding</a></li><li class="chapter-item expanded "><a href="tech_participants/validator_backup.html"><strong aria-hidden="true">2.1.2.</strong> backing up</a></li></ol></li><li class="chapter-item expanded "><a href="tech_participants/fullnodes.html"><strong aria-hidden="true">2.2.</strong> fullnodes</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Developer Guide</li><li class="chapter-item expanded "><a href="developer_guide/libra_core/index.html"><strong aria-hidden="true">3.</strong> libra-core</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developer_guide/libra_core/diem-node.html"><strong aria-hidden="true">3.1.</strong> diem-node</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developer_guide/libra_core/diem-node_config.html"><strong aria-hidden="true">3.1.1.</strong> config</a></li></ol></li><li class="chapter-item expanded "><a href="developer_guide/libra_core/consensus.html"><strong aria-hidden="true">3.2.</strong> consensus</a></li><li class="chapter-item expanded "><a href="developer_guide/libra_core/language.html"><strong aria-hidden="true">3.3.</strong> lanaguage move</a></li></ol></li><li class="chapter-item expanded "><a href="developer_guide/move/index.html"><strong aria-hidden="true">4.</strong> move</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developer_guide/move/move_stdlib.html"><strong aria-hidden="true">4.1.</strong> move stdlib</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developer_guide/move/move_stdlib_makechanges.html"><strong aria-hidden="true">4.1.1.</strong> make changes</a></li><li class="chapter-item expanded "><a href="developer_guide/move/move_stdlib_hotupgrades.html"><strong aria-hidden="true">4.1.2.</strong> hot upgrades</a></li><li class="chapter-item expanded "><a href="developer_guide/move/move_stdlib_test.html"><strong aria-hidden="true">4.1.3.</strong> test stdlib</a></li></ol></li><li class="chapter-item expanded "><a href="developer_guide/move/hello_world_move_mod.html"><strong aria-hidden="true">4.2.</strong> &quot;Hello, World!&quot; move module</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developer_guide/move/deploy_smartcontract.html"><strong aria-hidden="true">4.2.1.</strong> deploying</a></li><li class="chapter-item expanded "><a href="developer_guide/move/interact_with_smartcontract.html"><strong aria-hidden="true">4.2.2.</strong> interacting</a></li><li class="chapter-item expanded "><a href="developer_guide/move/FAQ.html"><strong aria-hidden="true">4.2.3.</strong> FAQ</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="developer_guide/carpe/index.html"><strong aria-hidden="true">5.</strong> carpe</a></li><li class="chapter-item expanded "><a href="developer_guide/bridge/index.html"><strong aria-hidden="true">6.</strong> bridge</a></li><li class="chapter-item expanded "><a href="developer_guide/testnet/index.html"><strong aria-hidden="true">7.</strong> testnet</a></li><li class="chapter-item expanded "><a href="developer_guide/ops/index.html"><strong aria-hidden="true">8.</strong> operations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="developer_guide/ops/error_codes.html"><strong aria-hidden="true">8.1.</strong> error codes</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Network Rescues</li><li class="chapter-item expanded "><a href="network_rescue/2022_april.html"><strong aria-hidden="true">9.</strong> 2022 April 100 onboard</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="network_rescue/2022_19_april_attempt.html"><strong aria-hidden="true">9.1.</strong> 2022 19 April attempt</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Get Involved</li><li class="chapter-item expanded "><a href="wg/index.html"><strong aria-hidden="true">10.</strong> Working Groups</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="wg/eng_wg.html"><strong aria-hidden="true">10.1.</strong> engineering-wg</a></li><li class="chapter-item expanded "><a href="wg/gov_wg.html"><strong aria-hidden="true">10.2.</strong> governance-wg</a></li><li class="chapter-item expanded "><a href="wg/analytics_wg.html"><strong aria-hidden="true">10.3.</strong> analytics-wg</a></li><li class="chapter-item expanded "><a href="wg/brand_and_commons_wg.html"><strong aria-hidden="true">10.4.</strong> branding-and-commons-wg</a></li><li class="chapter-item expanded "><a href="wg/coordinators_wg.html"><strong aria-hidden="true">10.5.</strong> coordinators-wg</a></li></ol></li><li class="chapter-item expanded "><a href="wg/index.html"><strong aria-hidden="true">11.</strong> Hustle Karma</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> Appendix</div></li><li><ol class="section"><li class="chapter-item expanded "><a href="keyword_acronyms.html"><strong aria-hidden="true">12.1.</strong> Keywords / Acronyms</a></li><li class="chapter-item expanded "><a href="FAQ.html"><strong aria-hidden="true">12.2.</strong> FAQ</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The 0L Developer Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="0l-blockchain"><a class="header" href="#0l-blockchain">0L Blockchain</a></h2>
<p>The 0L Blockchain is an open blockchain, with a core mission to give back, incentivize and reward contributors
and prevent free riders.</p>
<p>Let the games begin.</p>
<h2 id="links"><a class="header" href="#links">Links</a></h2>
<ul>
<li><a href="https://0l.network/">0l.network</a></li>
<li><a href="https://handbook.0l.network/index.php?title=Main_Page">0l handbook</a></li>
<li><a href="https://0l.network/technology/">0l technology</a></li>
<li><a href="https://hackmd.io/nfFgy-vHQWifld53YRXtXQ">hackmd</a></li>
<li><a href="https://calendar.google.com/calendar/u/0/embed?src=community@0l.network&amp;ctz=America/New_York">Community Calendar</a></li>
<li><a href="https://0l.interblockcha.in/">0L Explorer</a></li>
<li><a href="https://github.com/OLSF/libra">libra github</a></li>
<li><a href="https://github.com/OLSF/carpe">carpe github</a></li>
<li><a href="https://discord.gg/Ry2cf4NrbS">discord</a></li>
</ul>
<h2 id="engineering"><a class="header" href="#engineering">Engineering</a></h2>
<ul>
<li><a href="https://github.com/OLSF/libra/projects/6">libra project board</a></li>
<li><a href="https://airtable.com/shrCuXWvrZgHkspk7/tblixhNzkEaKt3a75">airtable</a></li>
</ul>
<h2 id="monitoring"><a class="header" href="#monitoring">Monitoring</a></h2>
<ul>
<li><a href="http://grafana.openlibra.space:3000/login">grafana dash</a></li>
<li><a href="https://0l.interblockcha.in/">0L Explorer</a></li>
</ul>
<h2 id="videos"><a class="header" href="#videos">Videos</a></h2>
<ul>
<li><a href="https://www.youtube.com/channel/UC5k7MBIQX62a0zBHFA29Hnw">OttO from 0L - community calls</a></li>
<li><a href="https://www.youtube.com/watch?v=FcPiiZNS8sA">carpe install</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h2 id="carpe-miners"><a class="header" href="#carpe-miners">Carpe Miners</a></h2>
<p>Help secure the network by mining &lt;what does this mean for carpe?&gt;
anyone can start right away, see.</p>
<ul>
<li><a href="https://github.com/OLSF/carpe">0L carpe github</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="validators"><a class="header" href="#validators">Validators</a></h1>
<p>Validators secure the network as participants of the IBFT consensus protocol which is based on HotStuff.</p>
<h4 id="technical-requirements-and-specs"><a class="header" href="#technical-requirements-and-specs">Technical Requirements and Specs</a></h4>
<p>250GB Disk Space<br />
16GB  Ram</p>
<p>Static IP</p>
<h4 id="open--accessible-ports"><a class="header" href="#open--accessible-ports">Open / Accessible Ports</a></h4>
<table><thead><tr><th>Port</th><th>Usage</th></tr></thead><tbody>
<tr><td>6179</td><td>listen_address - fullnode / transactions</td></tr>
<tr><td>6180</td><td>listen_address - validator / consensus</td></tr>
<tr><td>8080</td><td>JSON-RPC Port</td></tr>
<tr><td>3030</td><td>Web Monitor Frontent</td></tr>
</tbody></table>
<hr />
<p><a href="https://github.com/OLSF/libra/tree/main/diem-node">0L github - diem-node</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="validator-onboarding"><a class="header" href="#validator-onboarding">Validator Onboarding</a></h1>
<ul>
<li><a href="https://github.com/OLSF/libra/blob/main/ol/documentation/node-ops/validators/validator_onboarding_easy_mode.md">&quot;Onboard - Easy Mode&quot; onboard CLI</a></li>
<li><a href="https://github.com/OLSF/libra/blob/main/ol/documentation/node-ops/validators/validator_onboarding_hard_mode.md">&quot;Onboard - Hard Mode&quot; discrete steps</a></li>
</ul>
<pre><code class="language-console">$ RUST_LOG=error diem-node -f ~/.0L/validator.node.yaml &gt;&gt; ~/.0L/logs/validator.log 2&gt;&amp;1
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="backing-up"><a class="header" href="#backing-up">backing up</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fullnodes"><a class="header" href="#fullnodes">Fullnodes</a></h1>
<p>Accept transaction into the network and are responsible for getting the transactions to the validators.</p>
<p><a href="https://github.com/OLSF/libra/tree/main/diem-node">0L github - diem-node</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="libra-core"><a class="header" href="#libra-core">libra-core</a></h1>
<p>libra / 0L core is written in rust, a system programming laguage that has been gaining in popularity and 
power other blockchains such as Solana.</p>
<p><a href="https://github.com/OLSF/libra">OLSF/libra github</a></p>
<blockquote>
<h3 id="command-line-notation"><a class="header" href="#command-line-notation">Command Line Notation</a></h3>
<p>In this chapter and throughout the book, weâ€™ll show some commands used in the
terminal. Lines that you should enter in a terminal all start with <code>$</code>. You
donâ€™t need to type in the <code>$</code> character; it indicates the start of each
command. Lines that donâ€™t start with <code>$</code> typically show the output of the
previous command. Additionally, PowerShell-specific examples will use <code>&gt;</code>
rather than <code>$</code>.</p>
</blockquote>
<h2 id="rust-resources"><a class="header" href="#rust-resources">Rust Resources</a></h2>
<p><a href="https://doc.rust-lang.org/book">rust_book</a></p>
<p><a href="developer_guide/libra_core/">rust by example</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="diem-node"><a class="header" href="#diem-node">diem-node</a></h1>
<h3 id="modes"><a class="header" href="#modes">Modes</a></h3>
<ul>
<li>Fullnodes </li>
<li>Validator</li>
</ul>
<h3 id="running-diem-node"><a class="header" href="#running-diem-node">Running Diem-node</a></h3>
<pre><code class="language-console">$ git clone https://github.com/OLSF/libra.git
$ cd libra/diem-node
$ cargo build --release


$ ../target/release/diem-node -help
USAGE:
    diem-node [FLAGS] --config &lt;config&gt;

FLAGS:
    -h, --help            Prints help information
        --random-ports    Enabling random ports for testnet
        --test            Enable a single validator testnet
    -V, --version         Prints version information

OPTIONS:
    -f, --config &lt;config&gt;    Path to NodeConfig
</code></pre>
<p><strong>note</strong>: build sizes can be large! Just building diem-node -&gt; 6G debug, or 1.6G release</p>
<h2 id="start-a-local-diem-node-node"><a class="header" href="#start-a-local-diem-node-node">Start a local diem-node node</a></h2>
<p>TODO: as validator, fullnode..</p>
<pre><code class="language-console">$ ../target/release/diem-node --test --random-ports

initializing owner: 4C613C2F4B1E67CA8D98A542EE3F59F5
initializing owner: 4C613C2F4B1E67CA8D98A542EE3F59F5
Completed generating configuration:
	Log file: &quot;/private/var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/2ceeeae60a29b79b3404903c781bbdaa/validator.log&quot;
	Config path: &quot;/private/var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/2ceeeae60a29b79b3404903c781bbdaa/0/node.yaml&quot;
	Diem root key path: &quot;/private/var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/2ceeeae60a29b79b3404903c781bbdaa/mint.key&quot;
	Waypoint: 0:59374e97ac98dcf82638fc5419f7a1e3d640d380b5c2675dda47ebbdfe8047cc
	JSON-RPC endpoint: 0.0.0.0:51534
	FullNode network: /ip4/0.0.0.0/tcp/51542
	ChainId: TESTING

Diem is running, press ctrl-c to exit

====================================== 1 ======================================
====================================== 1 ======================================
====================================== 2 ======================================
0L ==== stdlib upgrade: checking for stdlib upgrade
====================================== 3 ======================================
</code></pre>
<h2 id="submit-an-rpc-call-to-your-local-node"><a class="header" href="#submit-an-rpc-call-to-your-local-node">Submit an RPC call to your local node</a></h2>
<p>see <a href="https://github.com/OLSF/libra/blob/main/json-rpc/json-rpc-spec.md">json-rpc-spec.md</a></p>
<pre><code class="language-console">$ curl -X POST -H &quot;Content-Type: application/json&quot; --data '{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;get_currencies&quot;,&quot;params&quot;:[],&quot;id&quot;:1}' &quot;http://0.0.0.0:51534/&quot;

{&quot;diem_chain_id&quot;:4,&quot;diem_ledger_version&quot;:1852,&quot;diem_ledger_timestampusec&quot;:1648355046274653,&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;id&quot;:1,&quot;result&quot;:[{&quot;code&quot;:&quot;GAS&quot;,&quot;scaling_factor&quot;:1000000,&quot;fractional_part&quot;:1000,&quot;to_xdx_exchange_rate&quot;:1.0,&quot;mint_events_key&quot;:&quot;050000000000000000000000000000000000000000000000&quot;,&quot;burn_events_key&quot;:&quot;060000000000000000000000000000000000000000000000&quot;,&quot;preburn_events_key&quot;:&quot;070000000000000000000000000000000000000000000000&quot;,&quot;cancel_burn_events_key&quot;:&quot;080000000000000000000000000000000000000000000000&quot;,&quot;exchange_rate_update_events_key&quot;:&quot;090000000000000000000000000000000000000000000000&quot;}]}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="diem-node-config"><a class="header" href="#diem-node-config">diem-node config</a></h1>
<h2 id="diem-node-files"><a class="header" href="#diem-node-files">diem-node files</a></h2>
<pre><code class="language-console">$ cd ~.0L/
$ ls

0L.toml                 key_store.json          account.json    
genesis.blob            genesis_waypoint.txt    validator.node.yaml
fullnode.node.yaml      monitor_cache.json       vdf_proofs      
web-monitor             restore                  db

$ ls db
consensusdb  diemdb
</code></pre>
<h3 id="0ltoml"><a class="header" href="#0ltoml">0L.toml</a></h3>
<pre><code class="language-toml">[workspace]
node_home = &quot;~/.0L/&quot;
block_dir = &quot;vdf_proofs&quot;
db_path = &quot;~/.0L/db&quot;

[profile]
account = &quot;12345678901234567890123456789012&quot;
auth_key = &quot;abcabcabcabcabcabcaabcabcabcabcabcabcbcabcabcabcabcabcabcabcabc&quot;
statement = &quot;Fun statement to start!&quot;
## Public ip of node
ip = &quot;1.2.3.4&quot;
default_node = &quot;http://localhost:8080/&quot;
upstream_nodes = [&quot;http://34.145.88.77:8080/&quot;,&quot;http://159.223.49.139:8080&quot;, &quot;http://138.197.59.9:8080/&quot;, &quot;http://35.231.138.89:8080/&quot;]
#upstream_nodes = [&quot;http://34.145.88.77:8080/&quot;]

[chain_info]
chain_id = &quot;1&quot;
## The epoch that you are starting in
base_epoch = 155 
base_waypoint = &quot;1234567:bbbbbbbbbbbaaaaaaaaaaaaaaaaabbbbbbbbbbbbbaaaaaaaaaaabbbbbbbbbbb&quot;
[tx_configs.baseline_cost]
max_gas_unit_for_tx = 10000
coin_price_per_unit = 1
user_tx_timeout = 5000

[tx_configs.critical_txs_cost]
max_gas_unit_for_tx = 1000000
coin_price_per_unit = 1
user_tx_timeout = 5000

[tx_configs.management_txs_cost]
max_gas_unit_for_tx = 100000
coin_price_per_unit = 1
user_tx_timeout = 5000

[tx_configs.miner_txs_cost]
max_gas_unit_for_tx = 10000
coin_price_per_unit = 1
user_tx_timeout = 5000

[tx_configs.cheap_txs_cost]
max_gas_unit_for_tx = 1000
coin_price_per_unit = 1
user_tx_timeout = 5000
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="consensus"><a class="header" href="#consensus">consensus</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lanaguage-move"><a class="header" href="#lanaguage-move">lanaguage move</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="move"><a class="header" href="#move">Move</a></h1>
<p>Smart contract language with formal verification and the idea of ownership baked into its programming model.</p>
<p>The stdlib for the 0L network is written in move. The stdlib defines the core protocol and rules of the 0L blockchain.
The move stdlib can be upgraded on the running network by deploying the new binary to a gobally accessible location
and having 2/3rd validator vote on accepting the new binary. </p>
<p>The <code>stdlib</code> defines basic protocol rules:
consensus, account creation, tx validation, etc. <a href="developer_guide/move/move_stdlib.html">see move_stdlib.md</a></p>
<p>TODO: <code>stdlib</code> (Vector.move, etc.) vs <code>diem-framework</code> (protocol code)</p>
<h2 id="modules-and-resources"><a class="header" href="#modules-and-resources">Modules and Resources</a></h2>
<h3 id="modules"><a class="header" href="#modules">Modules</a></h3>
<p><a href="https://move-book.com/syntax-basics/module.html">The Move Book - modules</a>
deployed to an address, e.g. <code>0x1{}</code> there is one copy of these and they can be referenced from scripts, or resources.
new types and resources can only be defined inside modules.
accessible to for others.</p>
<pre><code class="language-Move">address 0x1 {
  module Math {
      // module contents
  
      public fun sum(a: u64, b: u64): u64 {
          a + b
      }
  }
}
</code></pre>
<p>import
direct
<code>0x1::&lt;Module_Name&gt;::&lt;Resource|Type&gt;</code>
or</p>
<pre><code>use &lt;Address&gt;::&lt;ModuleName&gt;;

# access
ModuleName::{Method | Type};
</code></pre>
<h3 id="resources"><a class="header" href="#resources">Resources</a></h3>
<p><a href="https://move-book.com/resources/what-is-resource.html?highlight=resource#what-is-resource">see move book resource</a></p>
<blockquote>
<p>type with set of restrictions created to make this type safe enough to represent digital assets.</p>
</blockquote>
<p>non-copyable and non-droppable
and
storable and transferable between accounts</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>module M {
    struct T has key, store {
        field: u8
    }
}
<span class="boring">}
</span></code></pre></pre>
<h2 id="move-traits"><a class="header" href="#move-traits">Move Traits</a></h2>
<p><a href="https://move-book.com/advanced-topics/types-with-abilities.html">see move-book types with abilities</a></p>
<p><strong>Copy</strong> - value can be copied (or cloned by value).<br />
<strong>Drop</strong> - value can be dropped by the end of scope.<br />
<strong>Key</strong> - value can be used as a key for global storage operations.<br />
<strong>Store</strong> - value can be stored inside global storage.</p>
<h2 id="move-links"><a class="header" href="#move-links">Move Links</a></h2>
<p><a href="https://github.com/MystenLabs/awesome-move">Mysten labs awesome move</a></p>
<p><a href="https://move-book.com/introduction/foreword.html">The move book</a></p>
<p><strong>review</strong> <a href="https://github.com/OLSF/libra/blob/main/ol/documentation/move-dev/writing_and_publishing_thirdparty_modules.md">0L publishing third party module</a></p>
<p><strong>review</strong> <a href="https://github.com/OLSF/libra/blob/main/ol/documentation/core-devs/deploy_move_modules_using_diem_testnet.md">deploy move modules using diem testnet</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="0l-move-stdlib"><a class="header" href="#0l-move-stdlib">0L move stdlib</a></h1>
<p>The 0L move stdlib is deployed to the <code>0x1</code> address of the 0L network. </p>
<p>The stdlib includes a block prologue that is executed at the start of every block.</p>
<h2 id="changes-made-by-0l-network"><a class="header" href="#changes-made-by-0l-network">Changes Made By 0L Network</a></h2>
<p>Upgrades voted on</p>
<p>Removed root acct</p>
<p>Move: add decimal rust lib</p>
<p>Move: +chia VDF verifier to VM (verify delay towers)</p>
<p>Autopay - payments in future</p>
<p>+restore - snapshot fullnode sync from epic</p>
<p>Carpe - wallet + light miner</p>
<h2 id="move-stdlib-modules"><a class="header" href="#move-stdlib-modules">Move stdlib modules</a></h2>
<p><code>Signer.move</code>: wrapper around address</p>
<p><code>BCS.move</code>: utility for converting a MOVE val into its binary rep in BCS (Binary Canonical Serialization) see common/bcs</p>
<p><code>Event.move</code></p>
<p><code>FixedPoint32.move</code>: 32 bit integer part, 32 bit fractional bits.</p>
<p><code>Vector.move</code></p>
<p><code>Option.move</code>:</p>
<p><code>Error.move</code>: 0l added ol_tx and ol errors.</p>
<p><code>Hash.move</code> // natively declared in move runtime.</p>
<h2 id="0l-stdlib-code"><a class="header" href="#0l-stdlib-code">0L stdlib Code</a></h2>
<p><a href="https://github.com/OLSF/libra/tree/main/language/diem-framework/modules">Diem modules diem-framework/modules/</a><br />
<a href="https://github.com/OLSF/libra/tree/main/language/diem-framework/modules/0L">0L diem-framework/modules/0L</a><br />
<a href="https://github.com/OLSF/libra/tree/main/language/diem-framework/modules/0L_transaction_scripts">0L diem-framework/0L transaction scripts</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="move-stdlib"><a class="header" href="#move-stdlib">Move stdlib</a></h1>
<p>[TODO] - Not really stdlib, base framework? Or do we call them Move stdlib, OL stdlib, Diem stdlib?</p>
<p>The move stdlib modules for the 0L network lives under the <a href="https://github.com/OLSF/libra/tree/main/language/diem-framework/modules">language/diem-framework/modules</a> 
directory. The modules include the base modules for the original diem network as well as the 0L additions: <a href="https://github.com/OLSF/libra/tree/main/language/diem-framework/modules/0L">0L</a> 
and <a href="https://github.com/OLSF/libra/tree/main/language/diem-framework/modules/0L_transaction_scripts">0L transaction scripts</a> </p>
<p>The stdlib consists of <code>modules</code> and <code>scripts</code>. See the documentation of the current <code>modules</code> and <code>scripts</code>
<a href="https://github.com/OLSF/libra/tree/main/language/diem-framework/releases/artifacts/current/docs">here</a></p>
<h2 id="build-the-stdlib"><a class="header" href="#build-the-stdlib">Build The stdlib</a></h2>
<pre><code class="language-console">$ cd libra/language/diem-framework
$ cargo build
$ cargo run

NOTE: run this program in --release mode for better speed
Extracting linking/layout APIs from old module bytecodes ... (took 0.000s)
Compiling modules ... (took 15.771s)
Checking linking/layout compatibility ... (took 0.000s)
Generating module docs ... (took 23.920s)
Generating script docs ... (took 22.263s)
Generating script ABIs ... (took 22.149s)
Generating Rust script builder ... (took 0.414s)
Generating error explanations ... (took 20.986s)
</code></pre>
<p>or </p>
<pre><code class="language-console">
$ cd libra/target/debug
$ ./diem-framework 

NOTE: run this program in --release mode for better speed
Extracting linking/layout APIs from old module bytecodes ... (took 0.045s)
Compiling modules ... (took 18.148s)
Checking linking/layout compatibility ... (took 0.008s)
Generating module docs ... (took 22.826s)
Generating script docs ... (took 20.267s)
Generating script ABIs ... (took 20.335s)
Generating Rust script builder ... (took 0.438s)
Generating error explanations ... (took 21.328s)
</code></pre>
<h2 id="view-the-stdlib"><a class="header" href="#view-the-stdlib">View The stdlib</a></h2>
<pre><code class="language-console">$ cd libra/language/diem-framework/releases/artifacts/current/modules

$ ls

000_Signer.mv                          011_Event.mv                           022_StagingNet.mv                      
033_XDX.mv                             044_Authenticator.mv                   055_Bonding.mv                        
 066_DiemBlock.mv                       077_SystemAdministrationScripts.mv
001_Errors.mv                          012_DiemConfig.mv                      023_Hash.mv                            
034_TransactionFee.mv                  045_SharedEd25519PublicKey.mv          056_BridgeEscrow.mv                    
067_DiemConsensusConfig.mv             078_TestFixtures.mv
002_CoreAddresses.mv                   013_RegisteredCurrencies.mv            024_GAS.mv                            
 035_Receipts.mv                        046_RecoveryAddress.mv                 057_BridgeScripts.mv                   
 068_DiemVMConfig.mv                    079_TowerStateScripts.mv
003_DiemTimestamp.mv                   014_Diem.mv                            025_Globals.mv                         
036_FIFO.mv                            047_AccountAdministrationScripts.mv    058_Burn.mv                            
069_DiemVersion.mv                     080_TransferScripts.mv
004_SlidingNonce.mv                    015_AccountLimits.mv                   026_TowerState.mv                      
037_DualAttestation.mv                 048_AccountCreationScripts.mv          059_DemoScripts.mv                     
070_Upgrade.mv                         081_TreasuryComplianceScripts.mv
005_Signature.mv                       016_XUS.mv                             027_ValidatorUniverse.mv               
038_DiemTransactionPublishingOption.mv 049_AccountScripts.mv                  060_Migrations.mv                      
071_Oracle.mv                          082_ValidatorAdministrationScripts.mv
006_Roles.mv                           017_Option.mv                          028_NodeWeight.mv                      
039_DiemId.mv                          050_AutoPay.mv                         061_MigrateTowerCounter.mv             
072_Genesis.mv                         083_ValidatorScripts.mv
007_FixedPoint32.mv                    018_ValidatorOperatorConfig.mv         029_Cases.mv                           
040_DesignatedDealer.mv                051_Audit.mv                           062_Subsidy.mv                        
 073_Mock.mv                            084_WalletScripts.mv
008_Vector.mv                          019_ValidatorConfig.mv                 030_DiemSystem.mv                      
041_ChainId.mv                         052_AutoPayScripts.mv                  063_FullnodeSubsidy.mv                 
074_OracleScripts.mv
009_Testnet.mv                         020_VDF.mv                             031_Wallet.mv                         
 042_AccountFreezing.mv                 053_Decimal.mv                         064_Epoch.mv                          
  075_PaymentScripts.mv
010_BCS.mv                             021_Stats.mv                           032_VASP.mv                            
043_DiemAccount.mv                     054_Debug.mv                           065_EpochBoundary.mv                   076_PersistenceDemo.mv

</code></pre>
<h2 id="view-scripts"><a class="header" href="#view-scripts">View Scripts</a></h2>
<pre><code class="language-console">$ cd libra/language/diem-framework/releases/artifacts/current/script_abis

$ ls 

AccountAdministrationScripts   PaymentScripts                 TreasuryComplianceScripts      ol_account                     
ol_bridge                      ol_miner_state                 ol_transfer                    ol_wallet
AccountCreationScripts         SystemAdministrationScripts    ValidatorAdministrationScripts ol_autopay                     
ol_demo_e2e                    ol_oracle                      ol_validator
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="stdlib-hot-upgrades"><a class="header" href="#stdlib-hot-upgrades">stdlib hot upgrades</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="test-stdlib"><a class="header" href="#test-stdlib">Test stdlib</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hello-world-move-module"><a class="header" href="#hello-world-move-module">&quot;Hello, World!&quot; move module</a></h1>
<p>Our &quot;Hello, world!&quot; Move module will be a simple key value store. A move module that can set a value and retrieve a value.
We will use it to store things we are grateful for on chain.</p>
<h2 id="persistence-hello-world-move-module"><a class="header" href="#persistence-hello-world-move-module">Persistence &quot;Hello, World!&quot; Move module.</a></h2>
<p>See <a href="https://github.com/OLSF/libra/blob/main/ol/documentation/move-dev/writing_and_publishing_thirdparty_modules.md">writing_and_publishing_thirdparty_module</a><br />
uses <code>key</code> trait <a href="developer_guide/move/index.html#move-traits">see</a></p>
<pre><code class="language-Rust">//! account: alice, 1000000, 0, validator
//! account: bob, 1000000, 0, validator

// module {{default}}::PersistenceDemo{

// address will change based on the address you are deploying to, if running the 
// testnet, you'll see the address printed out when the testnet starts up.

module 0x4C613C2F4B1E67CA8D98A542EE3F59F5::PersistenceDemo {
        use 0x1::Vector;
        use 0x1::Signer;
       // use 0x1::Testnet::is_testnet;
    
        // In Move the types for data storage are `resource struct`. Here a type 
        // State is being defined. Once a type is initialized in the global state, 
        // the resource is treated as if in-memory on the heap, the libra database 
        // is abstracted. The data is namespaced by an &quot;access path&quot; which includes 
        // the module name and user address. No special APIs are necessary for 
        // reading from the database, except permissioning each function which 
        // accesses a given struct, more below.
        struct State has key {
          hist: vector&lt;u8&gt;,
        }

        // The operation can only be performed on testnet
        // const ETESTNET : u64 = 04001;

        // For this demo, the `initialize` function writes a PersistenceDemo::State 
        // resource at the &quot;sender&quot; address. The access path will be 
        // &lt;sender address&gt;/PersistenceDemo/State/
        public fun initialize(sender: &amp;signer){
          // `assert can be used to evaluate a bool and exit the program with an 
          // error code, 
          // e.g. testing if this is being run in testnet, and throwing error 01.
          // assert(is_testnet(), Errors::invalid_state(ETESTNET));
          // In the actual module, must assert that this is the sender is the 
          // association
          move_to&lt;State&gt;(sender, State{ hist: Vector::empty() });
        }


        // To read or write to a Resource Struct an `acquires` tag is 
        // needed to permission a function. 
        // NOTE all downsteam functions will also need permission on that 
        // data struct, i.e. need the same `acquires` parameters.
        public fun add_stuff(sender: &amp;signer ) acquires State {
          //assert(is_testnet(), Errors::invalid_state(ETESTNET));

          // Resource Struct state is always &quot;borrowed&quot; and &quot;moved&quot; and 
          // generally cannot be copied. 
          // A struct can be mutably borrowed, if it is written to, 
          // using `borrow_global_mut`. 
          // Note the Type State
          let st = borrow_global_mut&lt;State&gt;(Signer::address_of(sender));
          // the `&amp;` as in Rust makes the assignment to a borrowed value. Each Vector 
          // operation below with use a st.hist and return it before the 
          // next one can execute.
          let s = &amp;mut st.hist;

          // Move has very limited data types. Vector is the most sophisticated and 
          // resembles a simplified Rust vector.  Can be thought of as an array 
          // of a single type.
          Vector::push_back(s, 1);
          Vector::push_back(s, 2);
          Vector::push_back(s, 3);
        }

        // Similar to above, except removing state.
        public fun remove_stuff(sender: &amp;signer) acquires State{
          //assert(is_testnet(), Errors::invalid_state(ETESTNET));
          let st = borrow_global_mut&lt;State&gt;(Signer::address_of(sender));
          let s = &amp;mut st.hist;

          Vector::pop_back&lt;u8&gt;(s);
          Vector::pop_back&lt;u8&gt;(s);
          Vector::remove&lt;u8&gt;(s, 0);
        }

        // Here are examples of read operations. Note the `aquires` here again.
        public fun isEmpty(sender: &amp;signer): bool acquires State {
          //assert(is_testnet(), Errors::invalid_state(ETESTNET));

          // Note this is not a mutable borrow. Read only.
          let st = borrow_global&lt;State&gt;(Signer::address_of(sender));
          Vector::is_empty(&amp;st.hist)
        }

        // Showing the Vector::length method
        public fun length(sender: &amp;signer): u64 acquires State{
         // assert(is_testnet(), Errors::invalid_state(ETESTNET));
          let st = borrow_global&lt;State&gt;(Signer::address_of(sender));
          Vector::length(&amp;st.hist)
        }

        // Showing the Vector::contains method
        public fun contains(sender: &amp;signer, num: u8): bool acquires State {
          //assert(is_testnet(), Errors::invalid_state(ETESTNET));
          let st = borrow_global&lt;State&gt;(Signer::address_of(sender));
          Vector::contains(&amp;st.hist, &amp;num)
        }

    }
</code></pre>
<h3 id="transaction-scripts"><a class="header" href="#transaction-scripts">Transaction Scripts</a></h3>
<p>Interacting with deployed Move modules.</p>
<p>Now that the Move module has been deployed we can interact with it via Move <em>Transaction Scripts</em>.</p>
<p><strong>note:</strong> replace <code>{{default}}</code> with your address, e.g. <code>0x4C613C2F4B1E67CA8D98A542EE3F59F5</code>
Demo1 <code>add_stuff</code> assert that 3 items were added, 1,2,3.</p>
<pre><code class="language-Rust">//! new-transaction
//! sender: alice
script {
    use {{default}}::PersistenceDemo;
    
    // This sender argument was populated by the test harness with a random address 
    // for `alice`, which can be accessed with sender variable or the helper `{alice}`
    fun main(sender: signer){ // alice's signer type added in tx.
      let sender = &amp;sender;
      PersistenceDemo::initialize(sender);
      PersistenceDemo::add_stuff(sender);
      assert(PersistenceDemo::length(sender) == 3, 0);
      assert(PersistenceDemo::contains(sender, 1), 1);
    }
}
</code></pre>
<p>Demo2 check that there are not 2 items in the state. 
TODO: check VM error codes.</p>
<pre><code class="language-Rust">///// The tags with `check` matches to a string in the VM output. Here we are checking 
// for a correct execution.
// check: EXECUTED

//! new-transaction
//! sender: alice
script {
    use {{default}}::PersistenceDemo;
    fun main(sender: signer){
        let sender = &amp;sender;
      assert(PersistenceDemo::length(sender) == 2, 4);
    }
}

///// Checking the VM output for the string ABORTED

// check: ABORTED
</code></pre>
<p>Demo 3 fails because not initialized</p>
<pre><code class="language-Rust">///// DEMO 3: State is not initialized in BOB address
///// this will fail because bob does not have the data struct, and we tried to 
//// operate on it.  This is a new transaction.

//! new-transaction
//! sender: bob
script {
    use {{default}}::PersistenceDemo;
    fun main(sender: signer){
        let sender = &amp;sender;
        PersistenceDemo::add_stuff(sender);
    }
}

///// Checking the VM output for the string `EXECUTION_FAILURE`

// check: EXECUTION_FAILURE
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="deploying-smart-contracts"><a class="header" href="#deploying-smart-contracts">Deploying Smart Contracts</a></h1>
<h2 id="move-modules"><a class="header" href="#move-modules">Move Modules</a></h2>
<blockquote>
<p>Module is a set of functions and types packed together which the developer publishes under his address.</p>
</blockquote>
<p><a href="https://move-book.com/syntax-basics/module.html?highlight=Unbound,module,alias#module-and-import">see move book</a></p>
<h2 id="move-scripts"><a class="header" href="#move-scripts">Move Scripts</a></h2>
<h2 id="deploying-move-modules-to-local-testnet"><a class="header" href="#deploying-move-modules-to-local-testnet">Deploying Move Modules to local testnet</a></h2>
<p><a href="https://github.com/OLSF/libra/blob/main/ol/documentation/core-devs/deploy_move_modules_using_diem_testnet.md">see deploy_move_modules_using_diem_testnet</a></p>
<pre><code class="language-console">$ ./diem-node --test --random port

Entering test mode, this should never be used in production!
[config/management/genesis/src/storage_helper.rs:218] &quot;swarm 3&quot; = &quot;swarm 3&quot;
[config/management/genesis/src/storage_helper.rs:218] 
&amp;user = &quot;talent sunset lizard pill fame nuclear spy noodle basket okay critic grow sleep legend hurry pitch blanket clerk impose rough degree sock insane purse&quot;
[config/management/src/validator_config.rs:72] 
&amp;validator_address = /ip4/0.0.0.0/tcp/63818/ln-noise-ik/87b87096e8a7aec05ba62f5362acd1047fe6bbf0a480bf956a9b76e6b8a23103/ln-handshake/0
[config/management/src/validator_config.rs:89] 
&amp;fullnode_address = /ip4/0.0.0.0/tcp/63820/ln-noise-ik/1469513dfddeeb0a11f3cc54f8cae323cbd5b129ec2cf3ed63e11103984e7d3d/ln-handshake/0
initializing owner: 4C613C2F4B1E67CA8D98A542EE3F59F5
initializing owner: 4C613C2F4B1E67CA8D98A542EE3F59F5
Completed generating configuration:
	Log file: &quot;/private/var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/e520ce657a3e49e131d305db60cff0a7/validator.log&quot;
	Config path: &quot;/private/var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/e520ce657a3e49e131d305db60cff0a7/0/node.yaml&quot;
	Diem root key path: &quot;/private/var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/e520ce657a3e49e131d305db60cff0a7/mint.key&quot;
	Waypoint: 0:081599e48facd7709d2ce207db27df39cb6abd795c7c20e7ca5e97b84b6f4548
	JSON-RPC endpoint: 0.0.0.0:63812
	FullNode network: /ip4/0.0.0.0/tcp/63820
	ChainId: TESTING

Diem is running, press ctrl-c to exit

</code></pre>
<h4 id="start-cli"><a class="header" href="#start-cli">Start CLI</a></h4>
<p>To run the CLI you need to pass the WAYPOINT, JSON-RPC, ChainId, ROOT_KEY (path), for the running testnet:</p>
<pre><code>&amp;user = &quot;talent sunset lizard pill fame nuclear spy noodle basket okay critic grow sleep legend hurry pitch blanket clerk 
impose rough degree sock insane purse&quot;

Diem root key path: &quot;/private/var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/e520ce657a3e49e131d305db60cff0a7/mint.key&quot;

Waypoint: 0:081599e48facd7709d2ce207db27df39cb6abd795c7c20e7ca5e97b84b6f4548

JSON-RPC endpoint: 0.0.0.0:63812

ChainId: TESTING
</code></pre>
<p>We will export these variable in the same terminal session which we will be running the CLI.</p>
<pre><code class="language-console">
$ export ROOT_KEY=&quot;/private/var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/e520ce657a3e49e131d305db60cff0a7/mint.key&quot;
$ export CHAINID=&quot;TESTING&quot;
$ export WAYPOINT=&quot;0:081599e48facd7709d2ce207db27df39cb6abd795c7c20e7ca5e97b84b6f4548&quot;
$ export JSON-RPC_ENDPOINT=&quot;http://0.0.0.0:63812&quot;

</code></pre>
<p>Now we can run the CLI command, passing in the variables from our running testnet.
You will need your mneumonic for this.</p>
<pre><code class="language-console">// get the values from above, e.g. ChainId: TESTING, JSON-RPC endpoint  
$ cargo run -p cli -- -c $CHAINID -m $ROOT_KEY -u $JSON_RPC_ENDPOINT --waypoint $WAYPOINT 

Enter your 0L mnemonic:
ðŸ”‘
length: 6
Wallet recovered and the first 6 child accounts were derived
#0 address 4c613c2f4b1e67ca8d98a542ee3f59f5
#1 address 41db5082582e413725159a43b17c05c0
#2 address f185398445f13d4b01d53d1b07281e68
#3 address c46f39c1461c1bc83c2d2c60625af787
#4 address 64f0f978cc23d5d36d1f5125eec307ef
#5 address 828d998ffc9f45bbca8e4da5c85323f9
Connected to validator at: http://127.0.0.1:63812, latest version = 404, timestamp = 2022-03-29 16:37:35.754821 UTC
usage: &lt;command&gt; &lt;args&gt;

Use the following commands:

account | a
	Account operations
query | q
	Query operations
transfer | transferb | t | tb
	&lt;sender_account_address&gt;|&lt;sender_account_ref_id&gt; &lt;receiver_account_address&gt;|&lt;receiver_account_ref_id&gt; 
	&lt;number_of_coins&gt; &lt;currency_code&gt; [gas_unit_price_in_micro_diems (default=0)] [max_gas_amount_in_micro_diems 
	(default 400_000)] Suffix 'b' is for blocking.
	Transfer coins from one account to another.
info | i
	Print cli config and client internal information
node | n
	Get state of validators, miners.
oracle | o
	Oracle related commands
dev | d
	Local Move development
help | h
	Prints this help
quit | q!
	Exit this client


Please, input commands:

diem%
</code></pre>
<p>Create accounts using from the CLI REPL</p>
<pre><code class="language-console">diem% account create
&gt;&gt; Creating/retrieving next local account from wallet
Created/retrieved local account #6 address 7acc85d4e364dd4e6bbb752265ef7de9
</code></pre>
<p>Working with move <code>dev</code> command</p>
<pre><code class="language-console">diem% dev --help

usage: dev &lt;arg&gt;

Use the following args for this command:

compile | c &lt;sender_account_address&gt;|&lt;sender_account_ref_id&gt; &lt;file_path&gt; &lt;dependency_source_files...&gt;
	Compile Move program
publish | p &lt;sender_account_address&gt;|&lt;sender_account_ref_id&gt; &lt;compiled_module_path&gt;
	Publish Move module on-chain
execute | e &lt;sender_account_address&gt;|&lt;sender_account_ref_id&gt; &lt;compiled_module_path&gt; [parameters]
	Execute custom Move script
upgrade_stdlib | u
	Upgrade the move stdlib used for the blockchain
gen_waypoint | g
	Generate a waypoint for the latest epoch change LedgerInfo
change_diem_version | v &lt;new_diem_version&gt;
	Change the diem_version stored on chain
enable_custom_script | s
	Allow executing arbitrary script in the network. This disables script hash verification.
submit_writeset | ws &lt;path_to_writeset&gt;
	Submit a WriteSet with local diem root account. Path should be a bcs serialized TransactionPayload.
noop | n
	Calls demo_e2e tx script, for testing purposes
</code></pre>
<h4 id="compile-move-module"><a class="header" href="#compile-move-module">Compile Move Module</a></h4>
<p><code>dev compile</code> is the command we want to compile our <code>.move</code> source file to a binary.<br />
<code>compile | c &lt;sender_account_address&gt;|&lt;sender_account_ref_id&gt; &lt;file_path&gt; &lt;dependency_source_files...&gt;</code></p>
<p>The dependencies we need are in the <code>move-stdlib/modules</code> folder, use the fullpath.</p>
<pre><code class="language-console">diem% dev compile &lt;FULL_PATH&gt;/PersistenceDemo.move &lt;FULL_PATH_TO_LIBRA_PROJ&gt;/libra/language/move-stdlib/modules
  
    Finished dev [unoptimized + debuginfo] target(s) in 0.48s
     Running `target/debug/move-build &lt;FULL_PATH&gt;/PersistenceDemo.move -o /var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/d27846fb3466d7745dfa6a3626192cd2 -d &lt;FULL_PATH_TO_LIBRA_PROJ&gt;/libra/language/move-stdlib/modules`
Successfully compiled a program at:
  /var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/d27846fb3466d7745dfa6a3626192cd2/modules/0_PersistenceDemo.mv
</code></pre>
<h4 id="deploy--publish-move-module"><a class="header" href="#deploy--publish-move-module">Deploy / Publish Move Module</a></h4>
<p>Now you can deploy the module to the testnet
<code>publish | p &lt;sender_account_address&gt;|&lt;sender_account_ref_id&gt; &lt;compiled_module_path&gt; Publish Move module on-chain</code></p>
<pre><code class="language-console">diem% dev publish 4C613C2F4B1E67CA8D98A542EE3F59F5 /var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/d27846fb3466d7745dfa6a3626192cd2/modules/0_PersistenceDemo.mv
.....................................................................................................................................................................................................................................................
Successfully published module
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="interacting-with-move-module"><a class="header" href="#interacting-with-move-module">Interacting With Move Module</a></h1>
<p>In the previous section, we deployed a move module to our running testnet. Transaction scripts are the 
way that users interact with Move Modules.</p>
<table><thead><tr><th>Variable</th><th>Value for the Example</th></tr></thead><tbody>
<tr><td>Address</td><td><code>0x4C613C2F4B1E67CA8D98A542EE3F59F5</code></td></tr>
<tr><td>Tranasction Script Ref Page</td><td><a href="developer_guide/move/hello_world_move_mod.html">See Hello, World move module</a></td></tr>
</tbody></table>
<h3 id="transaction-scripts-1"><a class="header" href="#transaction-scripts-1">Transaction Scripts</a></h3>
<h4 id="compile-script"><a class="header" href="#compile-script">Compile Script</a></h4>
<p><strong>note</strong>: when compiling a script, make sure to include the dependent modules, if you deployed a module, make sure 
it is included in the dependencies with the same address. <code>module 0x4C613C2F4B1E67CA8D98A542EE3F59F5::PersistenceDemo</code></p>
<pre><code class="language-console">$ diem% dev compile &lt;FULL_PATH&gt;/Demo1.move &lt;FULL_PATH_TO_LIBRA_PROJ&gt;/libra/language/move-stdlib/modules
$ diem% dev compile  /Users/libby/Workspace.Libra/libra/Libby/movemods/Demo1.move /Users/libby/Workspace.Libra/libra/language/move-stdlib/modules /Users/libby/Workspace.Libra/libra/Libby/movemods/PersistenceDemo.move

    Finished dev [unoptimized + debuginfo] target(s) in 1.03s
     Running `target/debug/move-build /Users/libby/Workspace.Libra/libra/Libby/movemods/Demo1.move -o /var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/a7757976900af221d8c7754bbbacdb08 -d /Users/libby/Workspace.Libra/libra/language/move-stdlib/modules -d /Users/libby/Workspace.Libra/libra/Libby/movemods/PersistenceDemo.move`
Successfully compiled a program at:
  /var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/a7757976900af221d8c7754bbbacdb08/scripts/main.mv
  
</code></pre>
<h3 id="execute-compiled-move-script"><a class="header" href="#execute-compiled-move-script">Execute Compiled Move Script</a></h3>
<pre><code class="language-console">$ diem% dev execute 4C613C2F4B1E67CA8D98A542EE3F59F5  /var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/a7757976900af221d8c7754bbbacdb08/scripts/main.mv
.......................................................................................................................................................................................................................................
Successfully finished execution

// 2nd time
diem% dev execute 4C613C2F4B1E67CA8D98A542EE3F59F5  /var/folders/mx/6jxkfzlx4rbdlqg4lhwj74mm0000gn/T/a7757976900af221d8c7754bbbacdb08/scripts/main.mv
..............................................................................................................................................................................................................................................
Transaction failed to execute; status: ExecutionFailure { location: &quot;4C613C2F4B1E67CA8D98A542EE3F59F5::PersistenceDemo&quot;, function_index: 2, code_offset: 3 }!
</code></pre>
<h3 id="querying"><a class="header" href="#querying">Querying</a></h3>
<pre><code class="language-console">diem% q account_state 0x4C613C2F4B1E67CA8D98A542EE3F59F5
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="faqs"><a class="header" href="#faqs">FAQs</a></h1>
<p>Using this as a basic scratch sheet for figuring out error messages.</p>
<h2 id="errors-and-fixes"><a class="header" href="#errors-and-fixes">Errors and Fixes</a></h2>
<p><strong>E</strong>: It is still being borrowed</p>
<pre><code>    ^ Invalid return. Resource 'State' is still being borrowed.
    Â·
 81 â”‚         let v = Vector::borrow(&amp;st.hist, 0);
    â”‚                 --------------------------- It is still being borrowed by this reference
</code></pre>
<p><strong>E</strong>: * dereference</p>
<pre><code>  public fun get(sender: &amp;signer): u8 acquires State {
        let st = borrow_global&lt;State&gt;(Signer::address_of(sender));
        let elem = Vector::borrow(&amp;st.hist, 0);
        // we need the * or else &quot;It is still being borrowed by this reference&quot;
        *elem
  }
</code></pre>
<hr />
<p><strong>E</strong>: How do you get transaction hashes / receipts
q txn_acc_seq 4C613C2F4B1E67CA8D98A542EE3F59F5 2 true
<strong>F</strong>:</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="carpe"><a class="header" href="#carpe">carpe</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="0l-bridge"><a class="header" href="#0l-bridge">0l Bridge</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Phase one bridge is (Jan 2022) is a bridge between the 0L network and Ethereum mainnet. </p>
<h2 id="resources-1"><a class="header" href="#resources-1">Resources</a></h2>
<p><a href="https://github.com/coin1111/libra/tree/bridge-imp/ol/bridge">bridge core</a></p>
<h3 id="move-stdlib-1"><a class="header" href="#move-stdlib-1">move stdlib</a></h3>
<p><a href="https://github.com/coin1111/libra/blob/bridge-imp/language/diem-framework/modules/0L/BridgeEscrow.move">BridgeEscrow.move</a></p>
<p><a href="https://github.com/coin1111/libra/blob/bridge-imp/language/diem-framework/modules/0L/Burn.move">Burn.move</a></p>
<h3 id="tests"><a class="header" href="#tests">tests</a></h3>
<p><a href="https://github.com/coin1111/libra/blob/bridge-imp/ol/bridge/test-bridge.sh">Test Bridge</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rex-devnet"><a class="header" href="#rex-devnet">rex-devnet</a></h1>
<h2 id="resources-2"><a class="header" href="#resources-2">Resources</a></h2>
<p><a href="https://github.com/OLSF/libra/blob/d70716fb154339f4db71ae05edf8064013327b29/ol/documentation/core-devs/provision_dev_net.md">set up testnet</a></p>
<h2 id="quicksteps-verify"><a class="header" href="#quicksteps-verify">Quicksteps (verify)</a></h2>
<p>from @Daniyal</p>
<ol>
<li>
<p>All the rex node runners need permission to write to the https://github.com/OLSF/dev-genesis repo (later a GitHub token needs to be generated and used on the node)</p>
</li>
<li>
<p>Cloning OLSF/libra , OLSF/dev-genesis and OLSF/dev-epoch-archive repos on the node.</p>
</li>
<li>
<p>installing all the dependencies (libra/util/setup.sh).</p>
</li>
<li>
<p>setting up a persona, there are 3 default personas, alice, bob, carol. For example the alice node environment needs to setup by running this command: export NODE_ENV=test NS=alice TEST=y. New nodes have to create a new layout (checkout the Genesis ceremony on the provision_dev_net.md doc)</p>
</li>
<li>
<p>running make dev-register only for the first time to setup the node.</p>
</li>
<li>
<p>running make devnet</p>
</li>
</ol>
<h2 id="notes"><a class="header" href="#notes">Notes</a></h2>
<p>Here is the main doc to setup a testnet, needs a bit maintenance: 
https://github.com/OLSF/libra/blob/d70716fb154339f4db71ae05edf8064013327b29/ol/documentation/core-devs/provision_dev_net.md</p>
<p>Out the top of my head, here are the steps I remember:</p>
<ol>
<li>
<p>All the rex node runners need permission to write to the https://github.com/OLSF/dev-genesis repo 
(later a GitHub token needs to be generated and used on the node)</p>
</li>
<li>
<p>Cloning OLSF/libra , OLSF/dev-genesis and OLSF/dev-epoch-archive repos on the node.</p>
</li>
<li>
<p>Installing all the dependencies (libra/util/setup.sh):
sudo curl -sL https://raw.githubusercontent.com/OLSF/libra/main/ol/util/setup.sh | bash</p>
</li>
<li>
<p>Generate a GitHub token, place it in a (new) file called ~/.0L/github_token.txt</p>
</li>
<li>
<p>Setting up a persona, there are 5 default personas, alice, bob, carol,  dave and eve. For example the alice node 
environment needs to setup by running this command: export NODE_ENV=test NS=alice TEST=y. New nodes have to 
create a new layout (checkout the Genesis ceremony on the provision_dev_net.md doc)</p>
</li>
<li>
<p>Running make dev-register only for the first time to setup the node.</p>
</li>
<li>
<p>Running make devnet</p>
</li>
</ol>
<h2 id="volunteers-running-nodes"><a class="header" href="#volunteers-running-nodes">Volunteers Running Nodes</a></h2>
<p>Alice node, run by @daniyal: 148.251.89.142<br />
Bob node, run by @thenateway: 137.184.191.201<br />
Carol node, run by @o0l0o: 91.229.245.110  </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="operations"><a class="header" href="#operations">operations</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="error-codes"><a class="header" href="#error-codes">Error Codes</a></h1>
<p><a href="https://github.com/OLSF/libra/blob/main/ol/documentation/core-devs/error_codes.md">see</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="2022-april-100-onboard"><a class="header" href="#2022-april-100-onboard">2022 April 100 onboard</a></h1>
<h2 id="what-happened"><a class="header" href="#what-happened">What Happened?</a></h2>
<p>Block production stopped mid of epoch 165 (last block was produced 2022-04-09 at 12:00:34 CEST  / 10:00:34 UTC / 06:00:34 ET). In the subsequent epoch 166, validators were still failing to produce blocks and thus virtually no proofs were submitted.
This triggered a conditional in the 
<a href="https://github.com/OLSF/libra/blob/820ec66f3457fb26a4e24c952407d37f05ce6b1c/language/diem-framework/modules/0L/EpochBoundary.move#L148-L156">on chain move library EpochBoundry.move</a><br />
that contained a bug: instead of keeping the same validator set from the previous epoch, the <code>top_accounts</code>, capped at 100 
validators, made it to the next epoch 167. Out of the 100 validators in the new epoch, some were seemingly
not actively maintained and were unknown entities with no means of contacting the operators. </p>
<p>Attempt 1 (11 April 2022 4pm EST): There was a coordinated restart of the network done during a validator discord call. 
The validators on the call did a synchronized restart of the nodes they controlled and many 
validators set a <a href="https://github.com/OLSF/libra/blob/validator-autorestart-doc/ol/documentation/node-ops/auto_restart_validators.md">cron job to restart their validator every 1 hour</a>. 
It was requested that validator turn off towers and fullnodes
and only run their validators.<br />
Blocks started to be produced, albeit slower than normal, and occationally block production would be halted.</p>
<p>Next a <strong><a href="https://hackmd.io/8pNAlRk-TpypCgQVQGWHzw">detailed plan</a></strong> was outlined as to what next steps could be taken to recover the network.</p>
<blockquote>
<p>Plan A: Organize a Synchronous start with the 100 validators in the network.</p>
</blockquote>
<blockquote>
<p>Plan B: Issue a manual writeset transaction to overwrite the validator set to approx 10 validators, with no state change. (soft fork)</p>
</blockquote>
<blockquote>
<p>Plan C: Scorched earth state dump and overwrite validator set (approx 10), preserving only balances, tower-state, and validator configs.</p>
</blockquote>
<p>Eagle Network 15 April 2022 launched as a test network for a reconfigured validator set. </p>
<h2 id="links-1"><a class="header" href="#links-1">Links</a></h2>
<ul>
<li><a href="https://hackmd.io/8pNAlRk-TpypCgQVQGWHzw">2022 Apirl 13th POA / Call to action</a></li>
<li><a href="https://docs.google.com/spreadsheets/d/1T8-TzSQvICk3Q49ooGUxTACeE4_BZRnnBdxSIM-67Cw/edit#gid=0">epoch 168 validators</a></li>
<li><a href="https://docs.google.com/spreadsheets/d/1QRal4-LLuDZIiLyMsMV_2_nteuNc4avuykoPWg6Od_g/edit#gid=1546165814">11th April validator coordinated restart</a></li>
<li><a href="https://raw.githubusercontent.com/OLSF/seed-peers/main/fullnode_seed_playlist.json">fullnode seed playlist</a></li>
<li><a href="https://github.com/OLSF/epoch-archive/blob/main/Makefile">epoch-archive</a></li>
<li><a href="https://github.com/OLSF/libra/blob/rescue-mission/ol/documentation/network-upgrades/disaster-recovery.md">disaster-recovery doc - update db, update stdlib</a><br />
<strong>note</strong> <code>db-reference.tar.gz</code> should be in the cheatsheet will be @gnudrew25 snapshot as of 17th April 2022. 
<code>tar -xv db-reference.tar.gz ~/.0L/db</code> // in cheatsheet
should be the snapshot obtained from <code>https://home.gouin.io:5443/0L.167.tar.xz</code> 
<pre><code class="language-console">$ wget https://home.gouin.io:5443/0L.167.tar.xz

# takes a while as the tar is 70GB  
$ tar -xvf 0L.167.tar.xz
</code></pre>
</li>
</ul>
<h2 id="related-github-issues"><a class="header" href="#related-github-issues">Related Github Issues</a></h2>
<ul>
<li><a href="https://github.com/OLSF/libra/issues/1066">Only increase validator sets by at most 25% between epochs 1066</a> </li>
</ul>
<h2 id="rescue-mission-branch-and-docs"><a class="header" href="#rescue-mission-branch-and-docs">Rescue Mission Branch and Docs</a></h2>
<ul>
<li><a href="https://github.com/OLSF/libra/blob/rescue-mission/ol/documentation/network-upgrades/disaster-recovery.md">Plan B - Manual Overrides to State</a></li>
<li><a href="https://github.com/OLSF/libra/blob/rescue-mission/language/diem-tools/writeset-transaction-generator/Makefile">writeset-transaction-generator Makefile</a></li>
<li><a href="https://github.com/OLSF/libra/pull/1071">Network Recovery Tools</a></li>
</ul>
<h2 id="debug-commands--endpoints"><a class="header" href="#debug-commands--endpoints">Debug Commands / endpoints</a></h2>
<ul>
<li><a href="https://github.com/OLSF/libra/blob/validator-autorestart-doc/ol/documentation/node-ops/auto_restart_validators.md">set cron job to restart validators every hour</a></li>
<li>web server: obtain validator's IPs via the web monitor -&gt; validators -&gt; click on <code>(i)</code> icon next to the validator IP, check if reachable on port.</li>
</ul>
<pre><code class="language-console">$ nc -zv $IP 6180
</code></pre>
<ul>
<li>web server: vital endpoint http://$IP:3030/vitals</li>
<li><a href="https://github.com/OLSF/epoch-archive#backup-cli"><code>backup-cli</code></a>:
<ol>
<li><code>db-backup</code> tool <a href="https://github.com/diem/diem/blob/main/specifications/db_backup/spec.md">DiemDB Backup</a></li>
<li><code>db-restore</code> tool</li>
</ol>
</li>
<li><code>db-bootstrapper</code><br />
apply the writeset to the database <code>cargo r -p db-bootstrapper -- ~/.0L/db/ --genesis-txn-file ~/.0L/restore/rescue.blob</code> </li>
<li><code>diem-transaction-replay</code>: inspect state of db.<br />
export the 0x0 state to file for easy viewing:<br />
<code>cargo r -p diem-transaction-replay -- --db ~/.0L/db annotate-account 00000000000000000000000000000000 &gt; ~/.0L/dump-a sha256sum ~/.0L/dump-a</code></li>
<li><code> diem-writeset-generator</code>: create tx binaries and save the files (files applied later, e.g. via <code>db-bootstrapper</code>)</li>
<li>try reconfig event: <code>cargo r -p diem-writeset-generator -- --output ~/.0L/restore/rescue.blob reconfig ~/.0L/db</code></li>
<li>try stdlib update: <code>cargo r -p diem-writeset-generator -- --output ~/.0L/restore/rescue.blob update-stdlib ~/.0L/db</code></li>
<li><code>ol/genesis-tool</code></li>
<li><a href="https://github.com/OLSF/libra/blob/main/execution/db-bootstrapper/src/bin/db-bootstrapper.rs"><code>db-bootstrapper</code></a>: 
typically used to create genesis file, can be used to apply writeset to a database at rest (halted network).</li>
</ul>
<h2 id="relevant-code"><a class="header" href="#relevant-code">Relevant code</a></h2>
<ul>
<li>
<p><a href="https://github.com/OLSF/libra/issues/1063">BUG: Validator failover not implemented to spec</a></p>
</li>
<li>
<p><a href="https://github.com/OLSF/libra/blob/820ec66f3457fb26a4e24c952407d37f05ce6b1c/language/diem-framework/modules/0L/EpochBoundary.move#L148-L156">Epoch Boundry Val Selection</a></p>
</li>
<li>
<p><a href="https://github.com/OLSF/libra/blob/0b2f2901616bdf243151367d8e31f966d0280c1f/ol/genesis-tools/src/fork_genesis.rs">genesis tool: Fork Genesis</a></p>
</li>
<li>
<p><a href="https://github.com/OLSF/libra/blob/4d4a60f5dfe33b8121d97e46c67f77e6fe28b745/ol/genesis-tools/src/process_snapshot.rs">genesis tool: process snapshot</a></p>
</li>
<li>
<p><a href="https://github.com/OLSF/libra/pull/1071">PR Network Recovery Tools</a></p>
</li>
</ul>
<h2 id="backup--snapshot-information"><a class="header" href="#backup--snapshot-information">Backup / Snapshot Information</a></h2>
<p>@abed's <a href="https://github.com/OLSF/epoch-archive/pull/1">PR for backup and restore at a specific version</a>
<code>EPOCH=167 VERSION=37235342 make restore-version</code>
@abed's <a href="https://hackmd.io/8RYUiqrFQo6HbyU0evwXZw?view">detailed write up</a>  <code>backup-cli</code>: <code>db-backup</code> <code>db-restore</code></p>
<p>https://github.com/OLSF/epoch-archive/blob/main/165/transaction_37230877-.2066/transaction.manifest</p>
<blockquote>
<p>There are 3 different components to a backup so that a db can be &quot;bootstrapped&quot; and understandable by the diem-node .<br />
Epoch is meta information on the Epoch.<br />
State Snapshot is the state of the blockchain.<br />
Transactions are a history of txs.<br />
To bootstrap a working DB you need at least 1 tx. That's why we only put one for the purposes of epoch-archive.</p>
</blockquote>
<p><a href="https://github.com/OLSF/epoch-archive">epoch-archive README.md</a></p>
<blockquote>
<p>Backups are a way of bootstrapping the DB. There are 3 types of point-in-time backups:</p>
<p>Epoch Ending<br />
Transactions<br />
State Snapshot<br />
<strong>All three types of backups are needed to restore and bootstrap a database.</strong></p>
</blockquote>
<p>steps taken from <a href="https://github.com/OLSF/epoch-archive/blob/main/Makefile#L74">epoch-archive/MAKEFILE</a><br />
build backup-cli:<br />
<strong>note</strong> your SOURCE_PATH should be set to your libra project dir. </p>
<pre><code class="language-console">$ export SOURCE_PATH=~/libra
$ cd $SOURCE_PATH
$ cargo build -p backup-cli --release
$ cp -f ${SOURCE_PATH}/target/release/db-restore /usr/local/bin/db-restore
$ cp -f ${SOURCE_PATH}/target/release/db-backup /usr/local/bin/db-backup
</code></pre>
<h3 id="snapshot-issue"><a class="header" href="#snapshot-issue">Snapshot issue</a></h3>
<p>@Abed</p>
<pre><code>2022-04-16T14:07:36.417448Z [main] INFO storage/backup/backup-cli/src/backup_types/state_snapshot/backup.rs:58 State snapshot backup started, for version 30189516.
2022-04-16T14:07:36.424378Z [main] ERROR storage/backup/backup-cli/src/utils/error_notes.rs:14 Error raised, see notes. {&quot;error&quot;:&quot;request or response body error: error reading a body from connection: unexpected EOF during chunk size line&quot;,&quot;notes&quot;:&quot;\&quot;\&quot;&quot;}
2022-04-16T14:07:36.425423Z [main] ERROR storage/backup/backup-cli/src/bin/db-backup.rs:130 main_impl() failed: State snapshot backup failed: request or response body error: error reading a body from connection: unexpected EOF during chunk size line
Error: State snapshot backup failed: request or response body error: error reading a body from connection: unexpected EOF during chunk size line
</code></pre>
<p>@OD
I think it's because your state has be &quot;pruned&quot;
In node.yaml there is a prune_window field measured in blocks. So your prune window is smaller than the length of an 
epoch. So the db-tool can't find anything beyond
node/fullnode.yaml</p>
<pre><code class="language-yaml">...
storage:
address: &quot;127.0.0.1:6666&quot;
backup_service_address: &quot;127.0.0.1:6186&quot;
dir: db
grpc_max_receive_len: 100000000
prune_window: 20000
timeout_ms: 30000
...
</code></pre>
<h3 id="hot-stepper-uppers"><a class="header" href="#hot-stepper-uppers">Hot Stepper Uppers</a></h3>
<p>@Od - main debugging, code diving, solution propositions<br />
@gnudrew25 - db dump https://home.gouin.io:5443/0L.167.tar.xz</p>
<pre><code class="language-console">$ wget https://home.gouin.io:5443/0L.167.tar.xz

# takes a while as the tar is 70GB
$ tar -xvf 0L.167.tar.xz

</code></pre>
<p><code>71G  0L.167.tar.xz</code> 
extracted</p>
<pre><code>70G  	./db/diemdb
753M	./db/consensusdb
</code></pre>
<p>@shashank @jamesm - move code<br />
@Ping | ping.pub - tooling for flashing the stdlib<br />
@Barmaley<br />
@Adal - modifiying web app to expose ports<br />
@Abed - working with backup / snapshots<br />
<a href="https://github.com/OLSF/epoch-archive/pull/1/files">PR <code>EPOCH=167 VERSION=37235342 make restore-version</code></a>
@Daniyal
@drawks</p>
<h3 id="lessons-learned"><a class="header" href="#lessons-learned">Lessons Learned</a></h3>
<ul>
<li>Getting 100 validator to coordinate is hard.</li>
<li>No great way to contact validators. Validator contact info could be required in config? Maybe discord name, email or preferred contact.</li>
<li>Validators that are not active but have accumulated high voting power will potentially kick active validator out of the proposed validator set. </li>
<li>Full network archive 70G</li>
</ul>
<h2 id="prs-for-rescue"><a class="header" href="#prs-for-rescue">PRs For Rescue</a></h2>
<ul>
<li><a href="https://github.com/OLSF/libra/pull/1069/">jamesmeijers - update epoch boundry to failback to current validators</a></li>
<li><a href="https://github.com/OLSF/libra/pull/1071">tools - Network Recovery Tools and Epoch Boundary Hardening</a></li>
<li><a href="https://github.com/OLSF/libra/issues/1066">consensus Only increase validator sets by at most 25% between epochs</a></li>
</ul>
<h2 id="root-cause-analysis"><a class="header" href="#root-cause-analysis">Root Cause Analysis</a></h2>
<p>What could be seen in the logs is that different block proposals existed at the same time. Usually the proposer election algorithm should   chose deterministically one validator as block proposer for the next round and thus only one proposal should exist at a time. Maybe this is the cause, why no consensus could be found: with several proposals it is even more difficult to get a 2/3 majority on one proposal. </p>
<p>Why several block proposal exist simultaneously is open. Could be due to different config settings of validator nodes in the &quot;consensus&quot; section of validator.node.yaml.</p>
<h2 id="todos-this-will-be-updated-until-block-morale-improves"><a class="header" href="#todos-this-will-be-updated-until-block-morale-improves">TODOs (this will be updated until block morale improves)</a></h2>
<ul>
<li><input disabled="" type="checkbox"/>
We need a way to get a snapshot of an exact block height. See some info here: https://github.com/OLSF/epoch-archive
https://github.com/OLSF/epoch-archive
Correct failover issue in Move https://github.com/OLSF/libra/pull/1069/ @jamesm</li>
<li><input disabled="" type="checkbox"/>
Find db-backup db-restore sequence to share an archive between validators (volunteers?)</li>
<li><input disabled="" type="checkbox"/>
Code rust tools for write set generation @0D | 0o-de-lally</li>
<li><input disabled="" type="checkbox"/>
Code writeset for incrementing timestamp @Ping | ping.pub</li>
<li><input disabled="" type="checkbox"/>
Debug MoveVM cache not being invalidated @shb</li>
<li><input disabled="" type="checkbox"/>
Test block production in Eagle network @0D | 0o-de-lally</li>
<li><input disabled="" type="checkbox"/>
Test tower submission on Eagle @0D | 0o-de-lally</li>
<li><input disabled="" type="checkbox"/>
(Maybe) Change seat rotation algo  https://github.com/OLSF/libra/issues/1066 @shashank @keerthi</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="2022-19-april-attempt"><a class="header" href="#2022-19-april-attempt">2022 19 April Attempt</a></h1>
<p>Attempt to start the eagle fork at 6pm ET </p>
<h3 id="required"><a class="header" href="#required">Required</a></h3>
<ul>
<li>Gnudrews' backup database installed as /db (70G)<br />
@Barmaley â€”  @gnudrew25 db snapshot to this public URL: <a href="https://storage.googleapis.com/0l167/0L.167.tar.xz">https://storage.googleapis.com/0l167/0L.167.tar.xz</a>
<strong>This db will be required for the rescue effort.</strong></li>
</ul>
<h3 id="validators-1"><a class="header" href="#validators-1">Validators</a></h3>
<ol>
<li>@OD</li>
<li>Abed</li>
<li>Adal</li>
<li>Ashiiix</li>
<li>projecttent</li>
<li>Daniyal</li>
<li>drawks</li>
<li>misko9</li>
<li>nibbler</li>
<li>ricoflan</li>
<li>shashank</li>
<li>svanakin</li>
<li>Wade|TPT</li>
</ol>
<h3 id="nibblers-attempt"><a class="header" href="#nibblers-attempt">@nibbler's attempt</a></h3>
<p>Attempting to bring up validator on a new server</p>
<ol>
<li>copied relevant config files from running validator to a new box</li>
</ol>
<pre><code>0L.toml  account.json  fullnode.node.yaml  genesis.blob  genesis_waypoint.txt    
key_store.json  validator.node.yaml  vdf_proofs
</code></pre>
<ol start="2">
<li>downloaded Gnudrews' backup database to a mounted dir <code>/mnt/disks/disk2/netrecover/db/</code>
and made a symlink to the mounted from the .0l home dir <code>ln -s /mnt/disks/disk2/netrecover/db/ ~/.0L</code></li>
<li>updated paths in the config files to match new home dir.</li>
</ol>
<p>TODO: when ready will reassign the IP associated with the current validator to the new validator box
<code>104.197.186.76</code> and hope it all works...
4. reassigned ip, validator came up with db snapshot.
5. made it through steps <code>make check</code> </p>
<h3 id="need"><a class="header" href="#need">Need</a></h3>
<ul>
<li>account address</li>
<li>network network</li>
<li>shared <code>validator.node.yaml</code> share set of seeds.
to get info for <code>validator.yaml</code></li>
</ul>
<pre><code class="language-console">$ ol whoami
</code></pre>
<ol>
<li>use makefile that automats command line, </li>
<li>create a writeset on db at rest</li>
<li>commit it to new db then new start.</li>
<li>new start: updated move lib, change validator set, 167 to rescue validators</li>
<li>db is changed, but at rest</li>
<li>turn on node, will fail immediately.</li>
<li>all validators in rescue mission can find each other, then should start producing blocks.</li>
</ol>
<h2 id="steps"><a class="header" href="#steps">Steps</a></h2>
<p>1 </p>
<pre><code class="language-console">$ git checkout release-rescue-mission -f
$ make tx
Finished dev [unoptimized + debuginfo] target(s) in 3m 53s
     Running `target/debug/diem-writeset-generator --db /home/0L/.0L/db --output /home/0L/.0L/rescue/rescue.blob rescue ECAF65ADD1B785B0495E3099F4045EC0`
encode stdlib changeset

</code></pre>
<ol start="2">
<li>after it finishes run </li>
</ol>
<pre><code>$ make check 
</code></pre>
<p>check in <code>ol/rescue</code> look for waypoint</p>
<h2 id="need-everyones-validator-info-ol-whoami"><a class="header" href="#need-everyones-validator-info-ol-whoami">Need Everyone's Validator info <code>ol whoami</code></a></h2>
<p><a href="https://docs.google.com/spreadsheets/d/17Hd0xhIXdNmstLkI4cY5FBm6KrgdgZyWpBV3LK6CN-E/edit#gid=0">google sheet</a>
@nibbler</p>
<pre><code class="language-json">ol whoami
Enter your 0L mnemonic:
ðŸ”‘

0L ACCOUNT

address: 34B5D5E56EC27D954AC5D40B24D11422
...
----- noise protocol addresses -----

Validator (encrypted) address on VALIDATOR network

/ip4/104.197.186.76/tcp/6180/ln-noise-ik/c61044a4544c832bd998e0eded2fa7798a8f59b8219e0c9eef718c8b6f804b2a/ln-handshake/0

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-groups"><a class="header" href="#working-groups">Working Groups</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h2 id="engineering-working-group"><a class="header" href="#engineering-working-group">Engineering Working Group</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h2 id="governance-working-group"><a class="header" href="#governance-working-group">Governance Working Group</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h2 id="analytics-working-group"><a class="header" href="#analytics-working-group">Analytics Working Group</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h2 id="branding-and-commons-working-group"><a class="header" href="#branding-and-commons-working-group">Branding and Commons Working Group</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h2 id="coordinators-working-group"><a class="header" href="#coordinators-working-group">Coordinators Working Group</a></h2>
<div style="break-before: page; page-break-before: always;"></div><h1 id="working-groups-1"><a class="header" href="#working-groups-1">Working Groups</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="keywords--acronyms"><a class="header" href="#keywords--acronyms">Keywords / Acronyms</a></h1>
<p>Autopay</p>
<p>Account Types: end user, operators, validators</p>
<p>Proof of Elapsed Work</p>
<p>Slow Wallet</p>
<p>Stdlib</p>
<p>Tower -</p>
<p>VASP (Virtual Aseet Service Provider) - e.g. Exchange</p>
<p>VFN (Virtual Full Node) </p>
<p>Strong Identity</p>
<div style="break-before: page; page-break-before: always;"></div><h2 id="faq"><a class="header" href="#faq">FAQ</a></h2>
<p>Q. What are Carpe miners mining?<br />
A. Gas tokens</p>
<p>Q. What are Carpe miners mining?<br />
A. Gas tokens</p>
<p>Q. What are Carpe miners mining?<br />
A. Gas tokens</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
